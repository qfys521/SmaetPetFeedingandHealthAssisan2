import { PetBean } from '../model/PetBean'
import { PetHealthHistory } from '../model/PetHealthHistoryBean'
import { HttpUtil } from '../tools/HttpUtil'
import { ResponseBean } from '../model/ResponseBean'
import { DataListBean } from '../model/DataListBean'
import { JSON } from '@kit.ArkTS'
import { prompt } from '@kit.ArkUI'
import { DataSave } from '../tools/DataSave'
import { LoginSaveBean } from '../model/LoginSaveBean'

// å®šä¹‰ç±»å‹æ¥å£
interface DateRangeOption {
  value: string;
  label: string;
}

interface SpecificDateOption {
  value: string;
  label: string;
}

// æ–°å¢ï¼šå®šä¹‰Selecté€‰é¡¹æ¥å£
interface SelectOptionItem {
  value: string;
  content: string;
}

@Component
export struct ProfilePage {
  @State pet: PetBean = new PetBean()
  @State healthList: PetHealthHistory[] = []
  @State isLoading: boolean = false
  @State showEditDialog: boolean = false

  // æ—¥æœŸç­›é€‰ç›¸å…³çŠ¶æ€
  @State selectedDateRange: string = '7' // é»˜è®¤æœ€è¿‘7å¤©
  @State selectedSpecificDate: string = '' // é€‰ä¸­çš„å…·ä½“æ—¥æœŸ

  // ä¿®å¤ï¼šä½¿ç”¨æ˜ç¡®çš„ç±»å‹å£°æ˜
  @State dateRangeOptions: DateRangeOption[] = [
    { value: '1', label: 'æœ€è¿‘1å¤©' },
    { value: '3', label: 'æœ€è¿‘3å¤©' },
    { value: '7', label: 'æœ€è¿‘7å¤©' },
    { value: '30', label: 'æœ€è¿‘30å¤©' },
    { value: '90', label: 'æœ€è¿‘90å¤©' },
  ]

  @State specificDateOptions: SpecificDateOption[] = [] // å…·ä½“æ—¥æœŸé€‰é¡¹
  config: DataSave = new DataSave(this.getUIContext().getHostContext()!, 'loginData')
  userKey:string = this.config.get<LoginSaveBean>("loginSave").key??""

  dialogController: CustomDialogController = new CustomDialogController({
    builder: EditPetInfoDialog({
      cancel: () => {
        this.showEditDialog = false
      },
      confirm: (data: PetData) => {
        this.postSavePetData(data)
      },
    }),
  });

  promptAction = this.getUIContext().getPromptAction()

  aboutToAppear(): void {
    this.getPetInfo()
    this.getPetHealthRecords()
  }

  build() {
    Row() {
      Stack({ alignContent: Alignment.TopStart }) {
        // èƒŒæ™¯å›¾
        Image($r("app.media.bg2"))
          .width('100%')
          .height('100%')
          .objectFit(ImageFit.Cover)
          .objectRepeat(ImageRepeat.NoRepeat)

        // ä¸»ä½“å†…å®¹
        Column() {
          Column() {
            Text('å® ç‰©æ¡£æ¡ˆ')
              .fontSize(22)
              .fontWeight(FontWeight.Bold)
              .fontColor(this.getTitleColor())
              .margin({ top: 20 })
            Text('å® ç‰©ç®¡ç†ä¸åŸºç¡€ä¿¡æ¯')
              .fontColor(this.getSubTextColor())
              .fontSize(14)
          }
          .padding({ bottom: "16px" })

          // é‡æ–°è®¾è®¡çš„ç´§å‡‘åŸºç¡€èµ„æ–™å¡ç‰‡
          if (this.pet.petName) {
            this.buildPetProfileCard()
          }

          // æ—¥æœŸç­›é€‰å™¨ - æ”¾åœ¨åŸºç¡€èµ„æ–™ä¸‹é¢
          this.buildDateFilter()

          Scroll() {
            Column({ space: 12 }) {
              // åŒ»ç–—ä¸ç–«è‹—ä¿¡æ¯
              Column() {
                Text('åŒ»ç–—è®°å½•ä¸ç–«è‹—ä¿¡æ¯')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .margin({ top: 10, left: 10 , bottom: 10})



                // åˆ—è¡¨æ˜¾ç¤ºå® ç‰©å¥åº·è®°å½• - æ ¹æ®é€‰ä¸­çš„å…·ä½“æ—¥æœŸè¿‡æ»¤
                if (this.getFilteredHealthRecords().length === 0) {
                  this.buildNoRecords()
                } else {
                  ForEach(this.getFilteredHealthRecords(), (record: PetHealthHistory) => {
                    this.buildHealthRecordCard(record)
                  }, (record: PetHealthHistory, index: number) => `${record.recordDate}-${index}`)
                }
              }
              .width('90%')
              .backgroundColor($r('sys.color.interactive_select'))
              .borderRadius(10)
              .margin({ top: 5, bottom: 5 })

              // è¡Œä¸ºç‰¹å¾ä¸åå¥½
              Column() {
                Text('è¡Œä¸ºç‰¹å¾ä¸åå¥½')
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .margin({ top: 10, left: 10 })
                  .fontColor(Color.White)
                Text('ğŸ¾ å–œæ¬¢å®‰é™ã€æ€•é™Œç”Ÿäººï¼Œå¯¹é¸¡è‚‰è¿‡æ•ã€‚')
                  .fontColor(this.getTextColor())
                  .fontSize(14)
                  .fontColor(Color.White)
                  .margin({ left: 15, top: 5, bottom: 10 })
              }
              .width('90%')
              .backgroundColor($r('sys.color.interactive_select'))
              .borderRadius(10)
              .margin({ top: 5, bottom: 5 })
            }
          }
          .width('100%')
          .layoutWeight(1) // æ·»åŠ æƒé‡ç¡®ä¿Scrollå¯ä»¥æ»šåŠ¨
        }
      }
      .width('100%')
      .height('100%')
    }
  }

  // åŸºç¡€èµ„æ–™å¡ç‰‡ - ç´§å‡‘ç‰ˆæœ¬
  @Builder
  buildPetProfileCard(): void {
    Column({ space: 8 }) {
      // æ ‡é¢˜å’Œç¼–è¾‘æŒ‰é’®
      Row() {
        Text('ğŸ¾ åŸºç¡€èµ„æ–™')
          .fontSize(16)
          .fontWeight(FontWeight.Bold)
          .fontColor('#1a1a1a')

        Button('ç¼–è¾‘')
          .width("20%")
          .height(24)
          .fontSize(11)
          .fontColor('#FFFFFF')
          .onClick(() => {
            this.showEditDialog = true
            if (this.showEditDialog) {
              this.dialogController.open()
            }
          })
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceBetween)
      .padding({ left: 12, right: 12 })

      // ç´§å‡‘çš„å® ç‰©ä¿¡æ¯å¸ƒå±€
      Grid() {
        // ç¬¬ä¸€è¡Œ
        GridItem() { this.buildCompactProfileItem('åå­—', this.pet.petName, 'ğŸ“') }
        GridItem() { this.buildCompactProfileItem('ç§ç±»', this.pet.petSpecies, 'ğŸ•') }
        GridItem() { this.buildCompactProfileItem('æ€§åˆ«', this.pet.petGender, 'ğŸš»') }

        // ç¬¬äºŒè¡Œ
        GridItem() { this.buildCompactProfileItem('å‡ºç”Ÿ', this.pet.birthDate, 'ğŸ‚') }
        GridItem() { this.buildCompactProfileItem('ä½“é‡', this.pet.currentWeight!.toString() ? `${this.pet.currentWeight!.toString()}kg` : '--', 'âš–ï¸') }
        GridItem() { this.buildCompactProfileItem('å¥åº·', this.pet.healthStatus, 'â¤ï¸') }
      }
      .columnsTemplate('1fr 1fr 1fr')
      .rowsTemplate('1fr 1fr')
      .rowsGap(8)
      .columnsGap(8)
      .padding({ left: 12, right: 12, bottom: 12 })
    }
    .width('90%')
    .height('15%')
    .borderRadius(12)
    .shadow({ radius: 6, color: '#1a000000', offsetX: 0, offsetY: 1 })
    .margin({ top: 5, bottom: 20 })
  }

  // ç´§å‡‘çš„åŸºç¡€èµ„æ–™é¡¹ç»„ä»¶
  @Builder
  buildCompactProfileItem(label: string, value: string | undefined, icon: string): void {
    Column({ space: 2 }) {
      Row({ space: 4 }) {
        Text(icon)
          .fontSize(10)
        Text(label)
          .fontSize(18)
          .fontColor('#666666')
          .fontWeight(FontWeight.Medium)
          .fontSize(18)

      }
      .justifyContent(FlexAlign.Start)
      .width('100%')

      Text(value || '--')
        .fontSize(12)
        .fontColor('#1a1a1a')
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .textAlign(TextAlign.Start)
        .maxLines(1)
        .textOverflow({ overflow: TextOverflow.Ellipsis })
        .fontSize(14)
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
    .padding(4)
  }

  // æ—¥æœŸç­›é€‰å™¨ç»„ä»¶ - ä¿®æ”¹ä¸ºå‚ç›´å¸ƒå±€ï¼Œå­—ä½“è°ƒå°
  @Builder
  buildDateFilter(): void {
    Column({ space: 8 }) {
      // æ—¶é—´èŒƒå›´é€‰æ‹© - å ä¸€æ•´è¡Œ
      Row() {
        Text('æ—¶é—´èŒƒå›´:')
          .fontSize(12)
          .fontColor(this.getTextColor())
          .margin({ right: 8 })

        Select(this.dateRangeOptions.map((option: DateRangeOption): SelectOptionItem => {
          return {
            value: option.value,
            content: option.label
          }
        }))
          .selected(this.getSelectedIndex(this.dateRangeOptions, this.selectedDateRange))
          .onSelect((index: number) => {
            this.selectedDateRange = this.dateRangeOptions[index].value
            this.selectedSpecificDate = '' // æ¸…ç©ºå…·ä½“æ—¥æœŸé€‰æ‹©
            this.getPetHealthRecords()
          })
          .fontColor(this.getTextColor())
          .borderRadius(6)
          .padding(6)
          .width('70%')
      }
      .justifyContent(FlexAlign.Start)
      .alignItems(VerticalAlign.Center)
      .width('90%')
      .height(32)

      // å…·ä½“æ—¥æœŸé€‰æ‹©ï¼ˆä»…åœ¨æ—¶é—´èŒƒå›´é€‰æ‹©åæ˜¾ç¤ºï¼‰- å ä¸€æ•´è¡Œ
      if (this.specificDateOptions.length > 0) {
        Row() {
          Text('å…·ä½“æ—¥æœŸ:')
            .fontSize(12)
            .fontColor(this.getTextColor())
            .margin({ right: 8 })

          Select(this.specificDateOptions.map((option: SpecificDateOption): SelectOptionItem => {
            return {
              value: option.value,
              content: option.label
            }
          }))
            .selected(this.getSelectedIndex(this.specificDateOptions, this.selectedSpecificDate))
            .onSelect((index: number) => {
              this.selectedSpecificDate = this.specificDateOptions[index].value
            })
            .fontColor(this.getTextColor())
            .borderRadius(6)
            .padding(6)
            .width('70%')
        }
        .justifyContent(FlexAlign.Start)
        .alignItems(VerticalAlign.Center)
        .width('90%')
        .height(32)
      }
    }
    .width('90%')
    .alignItems(HorizontalAlign.Start)
    .padding({ left: 10, right: 10, top: 5})
    .backgroundColor($r('sys.color.interactive_select'))
    .borderRadius(10)
    .margin(10)
  }

  // è¾…åŠ©æ–¹æ³•ï¼šè·å–é€‰ä¸­é¡¹çš„ç´¢å¼•
  private getSelectedIndex(options: DateRangeOption[] | SpecificDateOption[], selectedValue: string): number {
    const index = options.findIndex((option: DateRangeOption | SpecificDateOption) => option.value === selectedValue);
    return index >= 0 ? index : 0;
  }

  // æ„å»ºå¥åº·è®°å½•å¡ç‰‡
  @Builder
  buildHealthRecordCard(record: PetHealthHistory): void {
    Column({ space: 8 }) {
      Text(`è®°å½•æ—¥æœŸï¼š${record.recordDate ?? '--'}`)
        .fontWeight(FontWeight.Bold)
        .fontColor(this.getTextColor())
        .fontSize(15)

      Grid() {
        GridItem() { this.buildInfoRow('ä½“é‡(kg)', record.bodyWeight!.toString()) }
        GridItem() { this.buildInfoRow('ä½“æ¸©(â„ƒ)', record.bodyTemperature!.toString()) }
        GridItem() { this.buildInfoRow('å¿ƒç‡', record.heartRate!.toString()) }
        GridItem() { this.buildInfoRow('é£Ÿæ¬²', record.appetiteLevel) }
        GridItem() { this.buildInfoRow('ç²¾åŠ›', record.energyLevel) }
        GridItem() { this.buildInfoRow('ç–«è‹—æ¥ç§', record.vaccinationStatus) }
      }
      .columnsTemplate('1fr 1fr')
      .width('100%')

      // å…¶ä»–ä¿¡æ¯
      this.buildInfoRow('ä¸Šæ¬¡æ¥ç§æ—¥æœŸ', record.lastVaccinationDate)
      this.buildInfoRow('é©±è™«çŠ¶æ€', record.dewormingStatus)
      this.buildInfoRow('ä¸Šæ¬¡é©±è™«æ—¥æœŸ', record.lastDewormingDate)

      // if (record.vetNotes && record.vetNotes !== '') {
      //   Column() {
      //     Text('å…½åŒ»å¤‡æ³¨:')
      //       .fontSize(14)
      //       .fontColor(this.getTextColor())
      //       .fontWeight(FontWeight.Medium)
      //       .margin({ bottom: 4 })
      //     Text(record.vetNotes)
      //       .fontSize(14)
      //       .fontColor('#666')
      //       .width('100%')
      //   }
      //   .width('100%')
      //   .margin({ top: 8 })
      // }
    }
    .width('95%')
    .backgroundColor('#99ffffff')
    .borderRadius(8)
    .padding(12)
    .margin({ bottom: 10 })
  }

  // æ— è®°å½•æ—¶çš„æ˜¾ç¤º
  @Builder
  buildNoRecords(): void {
    Column() {
      Image($r('sys.media.ohos_ic_public_clock'))
        .width(60)
        .height(60)
        .margin({ bottom: 16 })
      Text(this.selectedSpecificDate ? 'è¯¥æ—¥æœŸæš‚æ— è®°å½•' : 'æš‚æ— è®°å½•')
        .fontSize(16)
        .fontColor('#999')
    }
    .width('100%')
    .padding(40)
    .justifyContent(FlexAlign.Center)
    .alignItems(HorizontalAlign.Center)
  }

  // ==================
  // å°è£…UIè¾…åŠ©å‡½æ•°
  // ==================
  @Builder
  buildInfoRow(label: string, value?: string): void {
    Row() {
      Text(`${label}ï¼š`)
        .fontColor(this.getTextColor())
        .fontWeight(FontWeight.Medium)
        .fontSize(14)
      Text(value ?? '--')
        .fontColor(this.getValueColor())
        .fontWeight(FontWeight.Bold)
        .fontSize(14)
    }
    .justifyContent(FlexAlign.Start)
    .width('100%')
  }

  // ==================
  // æ•°æ®å¤„ç†æ–¹æ³•
  // ==================

  // è·å–è¿‡æ»¤åçš„å¥åº·è®°å½•
  private getFilteredHealthRecords(): PetHealthHistory[] {
    if (!this.selectedSpecificDate) {
      return this.healthList; // å¦‚æœæ²¡æœ‰é€‰æ‹©å…·ä½“æ—¥æœŸï¼Œæ˜¾ç¤ºæ‰€æœ‰è®°å½•
    }

    return this.healthList.filter((record: PetHealthHistory) => {
      if (!record.recordDate) return false;

      // æå–æ—¥æœŸéƒ¨åˆ†è¿›è¡Œæ¯”è¾ƒï¼ˆå¿½ç•¥æ—¶é—´éƒ¨åˆ†ï¼‰
      const recordDateOnly = this.extractDatePart(record.recordDate);
      return recordDateOnly === this.selectedSpecificDate;
    });
  }

  // ä»æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²ä¸­æå–æ—¥æœŸéƒ¨åˆ†
  private extractDatePart(dateTimeStr: string): string {
    if (!dateTimeStr) return '';

    // å‡è®¾æ—¥æœŸæ ¼å¼ä¸º "yyyy-MM-dd HH:mm" æˆ– "yyyy-MM-dd"
    const parts = dateTimeStr.split(' ');
    return parts[0]; // è¿”å›æ—¥æœŸéƒ¨åˆ†
  }

  // ç”Ÿæˆå…·ä½“æ—¥æœŸé€‰é¡¹
  private generateSpecificDateOptions(): void {
    const dateSet = new Set<string>();

    this.healthList.forEach((record: PetHealthHistory) => {
      if (record.recordDate) {
        const dateOnly = this.extractDatePart(record.recordDate);
        dateSet.add(dateOnly);
      }
    });

    // è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
    const dates = Array.from(dateSet).sort((a: string, b: string) => {
      return new Date(b).getTime() - new Date(a).getTime();
    });

    // ä¿®å¤ï¼šæ˜ç¡®åˆ›å»ºSpecificDateOptionæ•°ç»„
    const newOptions: SpecificDateOption[] = dates.map((date: string): SpecificDateOption => {
      return {
        value: date,
        label: date
      }
    });

    this.specificDateOptions = newOptions;

    // é»˜è®¤é€‰æ‹©æœ€æ–°çš„æ—¥æœŸ
    if (dates.length > 0 && !this.selectedSpecificDate) {
      this.selectedSpecificDate = dates[0];
    }
  }

  // ==================
  // ç½‘ç»œè¯·æ±‚éƒ¨åˆ†
  // ==================

  getPetInfo(): void {
    this.isLoading = true
    let result = new HttpUtil().httpRequestGet<ResponseBean<PetBean[]>>(
      "https://place.wxtcc.com.cn/officelease/pets/getPets",
      [
        { key: "key", value: this.userKey },
        { key: "userId", value: "1" }
      ]
    )
    result.then((value: ResponseBean<PetBean[]>) => {
      if (value?.data?.length) {
        this.pet = value.data[0]
        console.info(`[PetInfo] ${JSON.stringify(this.pet)}`)
      }
      console.info(`[PetInfo] ${JSON.stringify(value)}`)
    }).finally(() => {
      this.isLoading = false
    })
  }

  formatTime(date: Date): string {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    const hour = date.getHours().toString().padStart(2, '0');
    const minute = date.getMinutes().toString().padStart(2, '0');

    return `${year}-${month}-${day} ${hour}:${minute}`;
  }

  getTimeByOffset(s: number): string {
    const now = new Date();
    now.setSeconds(now.getSeconds() + s);
    return this.formatTime(now);
  }

  // è·å–å½“å‰æ—¶é—´
  getNowTime(): string {
    const now = new Date();
    return this.formatTime(now);
  }

  // æ ¹æ®é€‰æ‹©çš„æ—¥æœŸèŒƒå›´è®¡ç®—å¼€å§‹æ—¶é—´
  private getStartTimeByRange(): string {
    const now = new Date();
    const days = parseInt(this.selectedDateRange);

    if (days === 0) {
      // å…¨éƒ¨è®°å½•ï¼Œè¿”å›ä¸€ä¸ªå¾ˆæ—©çš„æ—¥æœŸ
      return '2020-01-01 00:00';
    }

    now.setDate(now.getDate() - days);
    return this.formatTime(now);
  }

  getPetHealthRecords(): void {
    this.isLoading = true
    let result = new HttpUtil().httpRequestGet<ResponseBean<DataListBean<PetHealthHistory>>>(
      "https://place.wxtcc.com.cn/officelease/pets/getPetHealthHistory",
      [
        { key: "key", value: this.userKey },
        { key: "petId", value: "1" },
        { key: "startTime", value: this.getStartTimeByRange() },
        { key: "endTime", value: this.getNowTime() },
        { key: "page", value: "1" },
        { key: "size", value: "50" }
      ]
    )

    result.then((value: ResponseBean<DataListBean<PetHealthHistory>>) => {
      const list = value?.data?.list ?? []
      this.healthList = list
      // ç”Ÿæˆå…·ä½“æ—¥æœŸé€‰é¡¹
      this.generateSpecificDateOptions()
      console.info(`[HealthRecord] ${JSON.stringify(value)}`)
    }).finally(() => {
      this.isLoading = false
    })
  }

  postSavePetData(petData: PetData): void {
    let result = new HttpUtil().httpRequestPost<ResponseBean<string>>(
      "https://place.wxtcc.com.cn/officelease/pets/updatePets",
      "",
      [
        { key: "key", value: this.userKey },
        { key: "petName", value: petData.petName || "" },
        { key: "petSpecies", value: petData.petSpecies || "" },
        { key: "petBreed", value: petData.petBreed || "" },
        { key: "petGender", value: petData.petGender || "" },
        { key: "birthDate", value: petData.birthDate || "" },
        { key: "currentweight", value: petData.currentWeight?.toString() || "" },
        { key: "healthstatus", value: petData.healthStatus || "" },
        { key: "id", value: "1" },
        { key: "userId", value: "1" }
      ]
    )
    result.then((value: ResponseBean<string>) => {
      this.promptAction.showToast({ message: "ğŸ¾ å® ç‰©ä¿¡æ¯å·²ä¿å­˜æˆåŠŸï¼" })
      setTimeout(() => {
        this.getPetInfo()
      }, 1500)
    })
  }

  // ==================
  // æ ·å¼å°è£…
  // ==================
  private getTextColor(): ResourceColor {
    return '#444444'
  }

  private getTitleColor(): ResourceColor {
    return '#1a1a1a'
  }

  private getSubTextColor(): ResourceColor {
    return '#777777'
  }

  private getValueColor(): ResourceColor {
    return '#0066CC'
  }
}

export class PetData {
  constructor(
    petName?: string,
    birthDate?: string,
    petSpecies?: string,
    petBreed?: string,
    currentWeight?: string,
    petGender?: string,
    healthStatus?: string,
  ) {
    this.petName = petName
    this.birthDate = birthDate
    this.petSpecies = petSpecies
    this.petBreed = petBreed
    this.currentWeight = currentWeight
    this.petGender = petGender
    this.healthStatus = healthStatus
  }

  petName?: string = ''
  birthDate?: string = ''
  petSpecies?: string = ''
  petBreed?: string = ''
  currentWeight?: string = ''
  petGender?: string = ''
  healthStatus?: string = ''
}

@CustomDialog
struct EditPetInfoDialog {
  @State petName: string = ''
  @State birthDate: string = ''
  @State petSpecies: string = ''
  @State petBreed: string = ''
  @State currentWeight: string = ''
  @State petGender: string = ''
  @State healthStatus: string = ''

  cancel: () => void = () => { }
  confirm: (data: PetData) => void = (data: PetData) => { }
  controller: CustomDialogController

  build() {
    Column({ space: 18 }) {
      Text('âœï¸ ç¼–è¾‘å® ç‰©åŸºç¡€ä¿¡æ¯')
        .fontSize(22)
        .fontWeight(FontWeight.Bold)
        .margin({ top: 10 })

      this.inputField('ğŸ¶ åå­—', 'è¯·è¾“å…¥å® ç‰©åå­—', (v: string) => this.petName = v)
      this.inputField('ğŸ‚ å‡ºç”Ÿæ—¥æœŸ', 'ä¾‹å¦‚ 2023-05-10', (v: string) => this.birthDate = v)
      this.inputField('ğŸ• ç§ç±»', 'ä¾‹å¦‚ é‡‘æ¯› / çŒ«å’ª', (v: string) => this.petSpecies = v)
      this.inputField('ğŸ¾ å“ç§', 'ä¾‹å¦‚ æ¯”ç†Š / è‹±çŸ­ / ç”°å›­çŒ«', (v: string) => this.petBreed = v)
      this.inputField('âš–ï¸ ä½“é‡(kg)', 'è¯·è¾“å…¥æ•°å­—', (v: string) => this.currentWeight = v, InputType.Number)
      this.inputField('ğŸš» æ€§åˆ«', 'é›„æ€§ / é›Œæ€§', (v: string) => this.petGender = v)
      this.inputField('â¤ï¸ å¥åº·çŠ¶æ€', 'è‰¯å¥½ / éœ€è¦å…³æ³¨', (v: string) => this.healthStatus = v)

      Row({ space: 20 }) {
        Button('å–æ¶ˆ')
          .width('40%')
          .height(44)
          .backgroundColor('#ccc')
          .fontColor('#000')
          .borderRadius(10)
          .onClick(() => {
            this.controller.close()
            this.cancel()
          })

        Button('ä¿å­˜')
          .width('40%')
          .height(44)
          .backgroundColor('#007DFF')
          .fontColor('#fff')
          .borderRadius(10)
          .onClick(() => {
            if (!this.petName) {
              prompt.showToast({ message: 'è¯·è¾“å…¥å® ç‰©åå­—' })
              return
            }
            const data = new PetData()
            data.petName = this.petName
            data.birthDate = this.birthDate
            data.petSpecies = this.petSpecies
            data.petBreed = this.petBreed
            data.currentWeight = this.currentWeight
            data.petGender = this.petGender
            data.healthStatus = this.healthStatus

            this.controller.close()
            this.confirm(data)
          })
      }
      .margin({ top: 20 })
    }
    .width('100%')
    .padding(20)
    .backgroundColor('#fff')
    .borderRadius(12)
  }

  @Builder
  inputField(label: string, placeholder: string, onChange: (v: string) => void, type: InputType = InputType.Normal) {
    Column() {
      Text(label).fontSize(16)
      TextInput({ placeholder: placeholder })
        .width('90%')
        .height(40)
        .type(type)
        .backgroundColor('#f5f5f5')
        .borderRadius(6)
        .onChange(onChange)
    }
  }
}